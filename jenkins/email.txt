pipeline {
    agent any

    environment {
        REPO_URL = 'https://your-bitbucket-server.com/scm/yourproject/your-repo.git'
        CREDENTIALS_ID = 'your-credentials-id'
        MAVEN_TOOL_NAME = 'Maven3' // Replace with your Maven tool name configured in Jenkins
        MAVEN_SETTINGS_FILE_CREDENTIALS_ID = 'your-maven-settings-config-id'
        EMAIL_RECIPIENT = 'your.email@example.com'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout([
                    $class: 'GitSCM', 
                    branches: [[name: "*/${env.BRANCH_NAME}"]],
                    doGenerateSubmoduleConfigurations: false, 
                    extensions: [], 
                    submoduleCfg: [], 
                    userRemoteConfigs: [[
                        credentialsId: "${env.CREDENTIALS_ID}", 
                        url: "${env.REPO_URL}"
                    ]]
                ])
            }
        }

        stage('Build and Upload Artifact') {
            steps {
                script {
                    def mavenHome = tool env.MAVEN_TOOL_NAME
                    def mavenSettings = withCredentials([file(credentialsId: env.MAVEN_SETTINGS_FILE_CREDENTIALS_ID, variable: 'MAVEN_SETTINGS_FILE')]) {
                        return "${env.MAVEN_SETTINGS_FILE}"
                    }

                    bat "${mavenHome}/bin/mvn clean install deploy -s ${mavenSettings}"

                    // Add additional Maven goals or parameters as needed
                }
            }
        }
    }

    post {
        success {
            emailext (
                subject: "Build Successful: ${env.JOB_NAME} - #${env.BUILD_NUMBER}",
                body: "The build succeeded. Check Jenkins for details.",
                to: "${env.EMAIL_RECIPIENT}"
            )
        }
        failure {
            emailext (
                subject: "Build Failed: ${env.JOB_NAME} - #${env.BUILD_NUMBER}",
                body: "The build failed. Check Jenkins for details.",
                to: "${env.EMAIL_RECIPIENT}"
            )
        }
    }
}
